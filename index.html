<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Christmas Countdown Radio</title>

<style>
html,body{
    margin:0;
    background:black;
    color:white;
    font-family:Arial,Helvetica,sans-serif;
    overflow:hidden;
}
#start{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:32px;
    cursor:pointer;
    user-select:none;
}
</style>
</head>
<body>

<div id="start">â–¶ START LIVE RADIO</div>

<script>
/* ================= CONFIG ================= */
const RADIO_START = new Date("Dec 1, 2025 00:00:00").getTime();

const SONG_NAMES = [
  "All I Want For Christmas Is You",
  "Baby It's Cold Outside",
  "Blue Christmas",
  "Carol Of The Bells",
  "Christmas (Baby Please Come Home)",
  "Christmas Canon",
  "Deck The Halls",
  "Do You Want To Build A Snowman",
  "Feliz Navidad",
  "Frosty The Snowman",
  "God Rest Ye Merry Gentlemen",
  "Here Comes Santa Claus",
  "Holly Jolly Christmas",
  "I Want A Hippopotamus For Christmas",
  "It's Beginning To Look A Lot Like Christmas",
  "It's The Most Wonderful Time Of The Year",
  "Jingle Bell Rock",
  "Jingle Bells",
  "Last Christmas",
  "Let It Snow! Let It Snow!",
  "Little Drummer Boy",
  "Mistletoe",
  "O Christmas Tree",
  "Rockin Around The Christmas Tree",
  "Rudolph The Red-Nosed Reindeer",
  "Santa Baby",
  "Santa Claus Is Comin' To Town",
  "Silent Night",
  "Sleigh Ride",
  "The Christmas Song",
  "Up On The Housetop",
  "We Wish You A Merry Christmas",
  "White Christmas",
  "Winter Wonderland",
  "Wonderful Christmastime",
  "You're A Mean One, Mr. Grinch"
];

const PLAYLIST = SONG_NAMES.map(name =>
  `songs/Music Now, Trap Music Now, Dance Music Now - ${name} (SPOTISAVER).mp3`
);

const SPEECH_SRC = "songs/speech.mp3";

/* ================= STATE ================= */
let audioCtx;
let durations = [];
let speechBuffer = null;

/* ================= METADATA DURATION ================= */
function getDuration(src){
    return new Promise(resolve=>{
        const a = new Audio();
        a.preload = "metadata";
        a.src = src;
        a.onloadedmetadata = ()=>{
            resolve(a.duration);
            a.src = "";
        };
        a.onerror = ()=>resolve(240);
    });
}

async function loadDurations(){
    for(const src of PLAYLIST){
        durations.push(await getDuration(src));
    }
}

/* ================= BUFFER LOAD ================= */
async function loadBuffer(src){
    const res = await fetch(src);
    const buf = await res.arrayBuffer();
    return await audioCtx.decodeAudioData(buf);
}

/* ================= PLAY LIVE ================= */
async function playLive(index, offset){
    const buffer = await loadBuffer(PLAYLIST[index]);

    if(offset >= buffer.duration){
        return playLive((index+1)%PLAYLIST.length, offset-buffer.duration);
    }

    const source = audioCtx.createBufferSource();
    const gain = audioCtx.createGain();
    gain.gain.value = 1;

    source.buffer = buffer;
    source.connect(gain).connect(audioCtx.destination);
    source.start(0, offset);

    if(!speechBuffer){
        speechBuffer = await loadBuffer(SPEECH_SRC);
    }

    const speechDelay = Math.max(0, buffer.duration - offset - 5);
    setTimeout(()=>{
        const s = audioCtx.createBufferSource();
        const g = audioCtx.createGain();
        g.gain.value = 1;

        gain.gain.value = 0.6;
        s.buffer = speechBuffer;
        s.connect(g).connect(audioCtx.destination);
        s.start();
        s.onended = ()=>gain.gain.value = 1;
    }, speechDelay*1000);

    setTimeout(()=>{
        playLive((index+1)%PLAYLIST.length, 0);
    }, (buffer.duration-offset)*1000);
}

/* ================= START ================= */
document.getElementById("start").onclick = async ()=>{
    document.getElementById("start").remove();

    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    await audioCtx.resume();

    await loadDurations();

    let elapsed = (Date.now() - RADIO_START) / 1000;
    const total = durations.reduce((a,b)=>a+b,0);
    elapsed = ((elapsed % total) + total) % total;

    let index = 0, offset = 0, sum = 0;
    for(let i=0;i<durations.length;i++){
        if(sum + durations[i] > elapsed){
            index = i;
            offset = elapsed - sum;
            break;
        }
        sum += durations[i];
    }

    playLive(index, offset);
};

/* ================= HARD CONTROL LOCK ================= */
document.addEventListener("keydown",e=>{
    if(
        e.code==="Space" ||
        e.code.startsWith("Media") ||
        e.ctrlKey || e.metaKey || e.altKey
    ){
        e.preventDefault();
        e.stopPropagation();
    }
},{capture:true});

document.addEventListener("contextmenu",e=>e.preventDefault());
</script>

</body>
</html>
